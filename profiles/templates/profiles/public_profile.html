{% extends "base.html" %}
{% load static %}

{% block title %}ReRoute | Public Profile{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/public_profile.css' %}">

<div class="public-profile-card">
  <div class="public-profile-header">
    <div class="avatar-wrap">
      {% if profile.profile_picture %}
        <img src="{{ profile.profile_picture.url }}" alt="{{ viewed_user.get_full_name|default:viewed_user.username }} profile photo" class="avatar avatar--sm">
      {% else %}
        <span class="avatar avatar--sm avatar--initials" aria-hidden="true">
          {% with fn=viewed_user.first_name ln=viewed_user.last_name %}
            {% if fn or ln %}{{ fn|slice:":1" }}{{ ln|slice:":1" }}{% else %}{{ viewed_user.username|slice:":2" }}{% endif %}
          {% endwith %}
        </span>
      {% endif %}
    </div>

    <div class="identity">
      <div class="name-row">
        <h1 class="display-name">
          {% with full=viewed_user.get_full_name %}
            {% if full %}{{ full }}{% else %}{{ viewed_user.username }}{% endif %}
          {% endwith %}
        </h1>
        {% if profile.verified %}
          <span class="verified-badge" title="Verified">Verified</span>
        {% endif %}
      </div>
      <div class="meta-row">
        <span class="handle">@{{ viewed_user.username }}</span>
        {% if profile.city or profile.state %}
          <span class="dot">•</span>
          <span class="location">{{ profile.city }}{% if profile.city and profile.state %}, {% endif %}{{ profile.state }}</span>
        {% endif %}
        {% if profile.status %}
          <span class="dot">•</span>
          <span class="status">{{ profile.status|capfirst }}</span>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="public-profile-body">
    <div class="section">
      <h2 class="section-title">About</h2>
      <p class="bio">
        {% if profile.bio %}
          {{ profile.bio|linebreaksbr }}
        {% else %}
          <em>No bio provided.</em>
        {% endif %}
      </p>
    </div>

    <div class="section">
      <h2 class="section-title">Skills</h2>
      <div class="tags">
        {% if resume and resume.skills.all %}
          {% for s in resume.skills.all %}
            <span class="tag">{{ s.name }}</span>
          {% empty %}
            <em>No skills listed.</em>
          {% endfor %}
        {% else %}
          <em>No skills listed.</em>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="public-profile-actions">
    {% if resume and is_owner %}
      <a class="btn btn-primary" href="{% url 'resumes:resume_preview' resume.id %}">View Resume</a>
      <a class="btn btn-secondary" href="{% url 'resumes:download_resume' resume.id %}">Download Resume</a>
    {% elif resume %}
      <!-- Viewer is an employer (this page is locked to employers). Provide read-only access links. -->
      <a class="btn btn-primary" href="{% url 'resumes:employer_view_resume' viewed_user.username %}">View Resume</a>
      <a class="btn btn-secondary" href="{% url 'resumes:employer_download_resume' viewed_user.username %}">Download Resume</a>
    {% else %}
      <span class="hint">No resume available.</span>
    {% endif %}
  </div>
</div>

{% endblock %}
