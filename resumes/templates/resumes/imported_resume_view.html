{% extends "base.html" %}
{% load static %}
{% block title %}Review Imported Resume{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'resumes/css/imported_resume.css' %}">

<div class="imported-resume-wrapper">
  <h2>ðŸ“„ Imported Resume Overview</h2>

  <!-- AI Summary Section -->
  {% if resume.ai_summary %}
    <div class="ai-summary-card">
      <h3>AI-Powered Summary</h3>
      <div class="ai-summary-content">
        {{ resume.ai_summary|linebreaks }}
      </div>
    </div>
  {% endif %}

  <!-- Detected structured fields -->
  <div class="detected-sections">
    {% if resume.contact_info %}
      <h3>Contact Info</h3>
      <ul>
        {% if resume.contact_info.full_name %}<li>Name: {{ resume.contact_info.full_name }}</li>{% endif %}
        {% if resume.contact_info.email %}<li>Email: {{ resume.contact_info.email }}</li>{% endif %}
        {% if resume.contact_info.phone %}<li>Phone: {{ resume.contact_info.phone }}</li>{% endif %}
        {% if resume.contact_info.city or resume.contact_info.state %}
          <li>Location: {{ resume.contact_info.city }}{% if resume.contact_info.state %}, {{ resume.contact_info.state }}{% endif %}</li>
        {% endif %}
      </ul>
    {% endif %}

    {% with skills=resume.skills.all %}
      {% if skills %}
        <h3>Skills</h3>
        <p>
          {% for s in skills %}
            <span class="skill-pill">{{ s.name }}</span>
          {% endfor %}
        </p>
      {% endif %}
    {% endwith %}

    {% with exps=resume.experience_entries.all %}
      {% if exps %}
        <h3>Experience</h3>
        <ul>
          {% for e in exps %}
            <li>
              <strong>{{ e.job_title }}</strong>{% if e.company %} at {{ e.company }}{% endif %}
              {% if e.dates %}<br><small>{{ e.dates }}</small>{% endif %}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    {% with edus=resume.education_entries.all %}
      {% if edus %}
        <h3>Education</h3>
        <ul>
          {% for ed in edus %}
            <li>
              <strong>{{ ed.school_name }}</strong>
              {% if ed.degree %} â€” {{ ed.degree }}{% endif %}
              {% if ed.graduation_year %} ({{ ed.graduation_year }}){% endif %}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
  </div>

  <!-- Raw Resume Text -->
  {% if resume.raw_text %}
    <details class="raw-section">
      <summary><strong> Raw Extracted Resume Text</strong> (click to expand)</summary>
      <pre class="raw-text-block">{{ resume.raw_text }}</pre>
    </details>
  {% endif %}

  <!-- Original file preview/download -->
  {% if resume.file %}
    <div class="file-preview">
      <h3>Original File</h3>
      <p><a href="{{ resume.file.url }}" target="_blank" rel="noopener">Download uploaded file</a></p>
      <object data="{{ resume.file.url }}" type="application/pdf" width="100%" height="600">
        <p>PDF preview unavailable. Use the download link above.</p>
      </object>
    </div>
  {% endif %}

  <!-- Save Button -->
  <form method="post" action="{% url 'resumes:imported_resume' resume.id %}">
    {% csrf_token %}
    <button type="submit" class="btn btn-primary mt-4">ðŸ’¾ Save Resume to Profile</button>
  </form>
</div>
{% endblock %}
