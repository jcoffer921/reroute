{% extends "base.html" %}
{% load static %}
{% load profile_extras %}

{% block title %}Job Opportunities{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'user/css/job_list.css' %}">

<!-- Full-width hero (outside the form) -->
<section class="opportunities-hero">
  <div class="opportunities-hero-content">
    <h1>Explore Job Opportunities</h1>
    <p class="hero-sub">Discover full-time, part-time, and second-chance hiring opportunities near you.</p>
    <p class="hero-coming-soon">Jobs Coming Soon.</p>
  </div>
</section>

<!-- Search + Filters + Results -->
<form method="get" action="{% url 'opportunities' %}" id="jobFilterForm" class="search-filter-form">
  <!-- Search just under the hero -->
  <div class="opportunities-wrapper">
    <div class="search-bar search-bar--inline">
      <input type="text" name="q" placeholder="Job title, keywords" value="{{ q }}" aria-label="Job title or keywords">
      <input type="text" name="zip" placeholder="Location (ZIP)" value="{{ user_zip }}" aria-label="Location by ZIP">
      <button type="submit" class="btn btn-primary">Search</button>
      <button type="button" class="mobile-filter-toggle" onclick="toggleFilters()">Filters</button>
    </div>
    <div class="container">
    <div class="container">
      <!-- Filters + Job List -->
      <div class="layout-grid">
        <!-- Filters Sidebar -->
        <aside class="filters-sidebar" id="filtersSidebar">
          <div class="filters-card">
            <h3 class="filters-title">Job Type</h3>
            <div class="pill-group">
              <label class="pill">
                <input type="checkbox" name="type" value="full_time" {% if 'full_time' in selected_job_types %}checked{% endif %}>
                <span>Full-Time</span>
              </label>
              <label class="pill">
                <input type="checkbox" name="type" value="part_time" {% if 'part_time' in selected_job_types %}checked{% endif %}>
                <span>Part-Time</span>
              </label>
              <label class="pill">
                <input type="checkbox" name="type" value="internship" {% if 'internship' in selected_job_types %}checked{% endif %}>
                <span>Internship</span>
              </label>
              <label class="pill">
                <input type="checkbox" name="type" value="contract" {% if 'contract' in selected_job_types %}checked{% endif %}>
                <span>Contract</span>
              </label>
            </div>

            <h3 class="filters-title">Location</h3>
            <div class="radio-group">
              <label class="radio-pill">
                <input type="radio" name="preset_zip" value="" {% if not selected_preset_zip %}checked{% endif %}>
                <span>Any</span>
              </label>
              <label class="radio-pill">
                <input type="radio" name="preset_zip" value="19104" {% if selected_preset_zip == '19104' %}checked{% endif %}>
                <span>Philadelphia</span>
              </label>
              <label class="radio-pill">
                <input type="radio" name="preset_zip" value="00000" {% if selected_preset_zip == '00000' %}checked{% endif %}>
                <span>Remote</span>
              </label>
            </div>

            <h3 class="filters-title">Radius</h3>
            <select name="radius" class="radius-select">
              <option value="10" {% if radius == 10 %}selected{% endif %}>10 miles</option>
              <option value="25" {% if radius == 25 %}selected{% endif %}>25 miles</option>
              <option value="50" {% if radius == 50 %}selected{% endif %}>50 miles</option>
            </select>
          </div>
        </aside>

        <!-- Job Listings -->
        <div class="job-list">
          {% if jobs %}
            {% for job in jobs %}
              <div class="job-card">
                  <div class="job-header">
                  {% with emp=job.employer %}
                    {% with logo=emp|employer_logo_url %}
                      <a href="{{ emp|employer_public_url }}">
                        {% if logo %}
                          <img src="{{ logo }}" alt="{{ emp|employer_company }} logo" class="job-logo">
                        {% else %}
                          <img src="{% static 'img/company-placeholder.svg' %}" alt="Company" class="job-logo">
                        {% endif %}
                      </a>
                    {% endwith %}
                  {% endwith %}
                  <div class="job-info">
                    <h2 class="job-title">
                      <a href="{% url 'job_detail' job.id %}" class="job-title-link">
                        {{ job.title }}
                      </a>
                    </h2>
                    <p class="job-company">
                      <a href="{{ job.employer|employer_public_url }}">{{ job.employer.username }}</a>
                      Â· {{ job.location }}
                    </p>
                  </div>
                </div>

                <div class="job-meta">
                  <div class="tags-row">
                    {% if job.experience_level %}
                      <span class="tag">{{ job.get_experience_level_display }}</span>
                    {% endif %}
                    <span class="tag">{{ job.get_job_type_display }}</span>
                    {% if job.location %}
                      <span class="tag">{{ job.location }}</span>
                    {% endif %}
                  </div>
                  <div class="pay-row">
                    <span class="pay-label">Pay</span>
                    <span class="pay-value">
                      {% if job.salary_type == 'hour' %}
                        ${{ job.hourly_min }} - ${{ job.hourly_max }} / hr
                      {% else %}
                        ${{ job.salary_min }}k - ${{ job.salary_max }}k / yr
                      {% endif %}
                    </span>
                  </div>
                </div>


                <div class="job-footer">
                  <p class="posted-time">Posted {{ job.created_at|timesince }} ago</p>
                  <div class="actions-row">
                    <form method="post" action="{% url 'apply_to_job' job.id %}">
                      {% csrf_token %}
                      <button type="submit" class="btn-apply">Apply Now</button>
                    </form>
                    <button type="button"
                            class="btn-save save-job-btn {% if job.id in saved_job_ids %}saved{% endif %}"
                            data-job-id="{{ job.id }}">
                      <span class="save-job">
                        <span class="save-job-icon-wrapper">
                          <svg class="bookmark-icon {% if job.id in saved_job_ids %}filled{% endif %}" xmlns="http://www.w3.org/2000/svg"
                              fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-4-7 4V5z" />
                          </svg>
                        </span>
                        <span class="save-label">
                          {% if job.id in saved_job_ids %}Saved{% else %}Save Job{% endif %}
                        </span>
                      </span>
                    </button>
                  </div>
                </div>
              </div>
          {% endfor %}
        {% else %}
          <p class="no-jobs">No job postings available at this time.</p>
        {% endif %}
        </div>
      </div>
    </div>
  </div>
</form>

<script>
  const toggleSaveUrl = "{% url 'toggle_saved_job' %}";
  const csrfToken = "{{ csrf_token }}";
</script>
<script src="{% static 'user/js/job_list.js' %}"></script>

{% endblock %}
