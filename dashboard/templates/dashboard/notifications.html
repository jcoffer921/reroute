{% extends "base.html" %}
{% load static %}
{% load profile_extras %}
{% block content %}
<link rel="stylesheet" href="{% static 'dashboard/css/notifications.css' %}">

<div class="notifications-page">
  <header class="notifications-header">
    <h1>Notifications</h1>
    <form id="markAllForm" method="post">
      {% csrf_token %}
      <input type="hidden" name="action" value="mark_all_read">
      <button type="submit" class="btn-mark-read">Mark All as Read</button>
    </form>
  </header>

  <!-- Tabs -->
  <nav class="notifications-tabs">
    <button class="tab active" data-filter="all" type="button">All</button>
    <button class="tab" data-filter="jobs" type="button">Jobs</button>
    <button class="tab" data-filter="system" type="button">System</button>
    <button class="tab" data-filter="admin" type="button">Admin</button>
    <button class="tab" data-filter="tips" type="button">Tips</button>
  </nav>

  <!-- Notification List -->
  <section class="notifications-list" id="notificationsList">
    {% if notifications %}
      {% for n in notifications %}
        <article class="notification-card {% if not n.is_read %}unread{% endif %}">
          <div class="avatar {% if not n.actor %}admin{% endif %}">
            {% if n.actor and n.actor|profile_picture_url %}
              <img src="{{ n.actor|profile_picture_url }}" alt="Avatar">
            {% elif n.actor %}
              {{ n.actor|initials }}
            {% else %}
              R
            {% endif %}
          </div>
          <div class="content">
            <div class="title">{{ n.title|default:n.verb|default:"Update" }}</div>
            <div class="message">{{ n.message }}</div>
            <div class="meta">
              {% if not n.is_read %}<span class="unread-dot" aria-label="Unread"></span>{% endif %}
              <time datetime="{{ n.created_at|date:'c' }}">{{ n.created_at|timesince }} ago</time>
            </div>
          </div>
          <div class="actions">
            {% if n.url %}
              <a href="{{ n.url }}" class="btn-action">View</a>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    {% else %}
      <p class="empty">No notifications yet.</p>
    {% endif %}
  </section>
</div>

<script src="{% static 'dashboard/js/notifications.js' %}"></script>
{% endblock %}
