{% extends "base.html" %}
{% load static %}
{% block title %}Review Imported Resume{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'resumes/css/imported_resume.css' %}">

<div class="imported-resume-wrapper">
  <h2>ðŸ“„ Imported Resume Overview</h2>

  <!-- AI Summary Section -->
  <div class="ai-summary-card">
    <h3>Professional Summary</h3>
    <div class="ai-summary-content">
      {% if resume.summary %}
        {{ resume.summary }}
      {% else %}
        {{ ai_summary_snippet }}
      {% endif %}
    </div>
  </div>

  <!-- Structured sections -->
  <div class="resume-grid">
    <div class="col-left">
      {% if resume.contact_info %}
        <section class="resume-section">
          <h3>Contact Info</h3>
          <ul class="clean-list">
            {% if resume.contact_info.full_name %}<li><strong>Name:</strong> {{ resume.contact_info.full_name }}</li>{% endif %}
            {% if resume.contact_info.email %}<li><strong>Email:</strong> {{ resume.contact_info.email }}</li>{% endif %}
            {% if resume.contact_info.phone %}<li><strong>Phone:</strong> {{ resume.contact_info.phone }}</li>{% endif %}
            {% if resume.contact_info.city or resume.contact_info.state %}
              <li><strong>Location:</strong> {{ resume.contact_info.city }}{% if resume.contact_info.state %}, {{ resume.contact_info.state }}{% endif %}</li>
            {% endif %}
          </ul>
        </section>
      {% endif %}

      {% with skills=resume.skills.all %}
        {% if skills %}
          <section class="resume-section">
            <h3>Skills</h3>
            <ul class="skills-list">
              {% for s in skills %}
                <li class="skill-pill">{{ s.name|title }}</li>
              {% endfor %}
            </ul>
          </section>
        {% endif %}
      {% endwith %}

      {% if resume.certifications %}
        <section class="resume-section">
          <h3>Certifications</h3>
          <ul class="clean-list">
            {% for line in resume.certifications.splitlines %}
              {% if line.strip %}<li>{{ line }}</li>{% endif %}
            {% endfor %}
          </ul>
        </section>
      {% endif %}
    </div>

    <div class="col-right">
      {% with edus=resume.education_entries.all %}
        {% if edus %}
          <section class="resume-section">
            <h3>Education</h3>
            <ul class="clean-list">
              {% for ed in edus %}
                <li>
                  <strong>{{ ed.school_name }}</strong>
                  {% if ed.degree %} â€” {{ ed.degree }}{% endif %}
                  {% if ed.graduation_year %} ({{ ed.graduation_year }}){% endif %}
                </li>
              {% endfor %}
            </ul>
          </section>
        {% endif %}
      {% endwith %}

      {% with exps=resume.experience_entries.all %}
        {% if exps %}
          <section class="resume-section">
            <h3>Experience</h3>
            <ul class="clean-list">
              {% for e in exps %}
                <li>
                  <strong>{{ e.job_title }}</strong>{% if e.company %} at {{ e.company }}{% endif %}
                  {% if e.dates %}<div class="muted">{{ e.dates }}</div>{% endif %}
                </li>
              {% endfor %}
            </ul>
          </section>
        {% endif %}
      {% endwith %}

      {% if resume.file %}
        <section class="resume-section file-preview">
          <h3>Original File</h3>
          <object data="{{ resume.file.url }}" type="application/pdf" width="100%" height="420">
            <p>PDF preview unavailable. Use the download button below.</p>
          </object>
        </section>
      {% endif %}
    </div>
  </div>

  <!-- Raw Resume Text -->
  <details class="raw-section">
    <summary>View Raw Data (Developers Only)</summary>
    {% if extracted_json_pretty %}
      <h4>Extracted JSON</h4>
      <pre class="raw-text-block">{{ extracted_json_pretty }}</pre>
    {% endif %}
    {% if resume.raw_text %}
      <h4>Raw Extracted Resume Text</h4>
      <pre class="raw-text-block">{{ resume.raw_text }}</pre>
    {% endif %}
  </details>

  <!-- Actions -->
  <div class="actions-row">
    <form method="post" action="{% url 'resumes:imported_resume' resume.id %}">
      {% csrf_token %}
      <button type="submit" class="rr-btn rr-btn-primary" aria-label="Save resume to profile">
        <svg class="rr-btn__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M17 3H7a2 2 0 0 0-2 2v14l7-3 7 3V5a2 2 0 0 0-2-2z" stroke="currentColor" stroke-width="1.6" fill="none"/>
        </svg>
        Save to Profile
      </button>
    </form>
    <a class="rr-btn rr-btn-secondary" href="{% url 'resumes:download_resume' resume.id %}" aria-label="Download resume as PDF">
      <svg class="rr-btn__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M6 2h9l5 5v15a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="1.6" fill="none"/>
        <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.6"/>
      </svg>
      Download as PDF
    </a>
    {% if resume.file %}
      <a class="rr-btn rr-btn-secondary" href="{{ resume.file.url }}" target="_blank" rel="noopener" aria-label="Download original uploaded file">
        <svg class="rr-btn__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M12 3v12" stroke="currentColor" stroke-width="1.6"/>
          <path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="1.6"/>
          <path d="M4 20h16" stroke="currentColor" stroke-width="1.6"/>
        </svg>
        Download File
      </a>
    {% endif %}
  </div>
</div>
{% endblock %}
