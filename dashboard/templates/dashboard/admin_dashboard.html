{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'dashboard/css/admin_dashboard.css' %}">

<section class="admin-hero">
  <div class="admin-hero-content">
    <h1>Welcome, Admin!</h1>
  </div>
</section>

<div class="admin-dashboard">
  
  <!-- Quick Stats -->
  <div class="stats-grid">
    <div class="stat-box stat-box--users">
      <div class="stat-box__label">Users</div>
      <div class="stat-box__value">{{ user_count }}</div>
    </div>
    <div class="stat-box stat-box--employers">
      <div class="stat-box__label">Employers</div>
      <div class="stat-box__value">{{ employer_count }}</div>
    </div>
    <div class="stat-box stat-box--jobs">
      <div class="stat-box__label">Jobs</div>
      <div class="stat-box__value">{{ job_count }}</div>
    </div>
    <div class="stat-box stat-box--applications">
      <div class="stat-box__label">Applications</div>
      <div class="stat-box__value">{{ application_count }}</div>
    </div>
    <div class="stat-box stat-box--resumes">
      <div class="stat-box__label">Resumes</div>
      <div class="stat-box__value">{{ resume_count }}</div>
    </div>
    <div class="stat-box stat-box--flagged">
      <div class="stat-box__label">Flagged Items</div>
      <div class="stat-box__value">{{ flagged_jobs|length }}</div>
    </div>
  </div>

  <!-- Charts -->
  <h2>Analytics (Last 30 Days)</h2>
  <div class="charts-grid">
    <canvas id="usersChart"></canvas>
    <canvas id="jobsChart"></canvas>
  </div>

  <!-- Recent Activity -->
  <section>
    <h2>Recent Activity (Last 7 Days)</h2>
    <ul>
      <li>New Users: {{ new_users|default:0 }}</li>
      <li>New Jobs: {{ new_jobs|default:0 }}</li>
      <li>New Applications: {{ new_applications|default:0 }}</li>
    </ul>
  </section>

  <!-- Review Queue -->
   <section>
    <h2>Flagged Jobs (Trust & Safety)</h2>
  {% if flagged_jobs %}
    <div class="table-responsive">
    <table>
      <tr>
        <th>Title</th>
        <th>Employer</th>
        <th>Reason</th>
        <th>Actions</th>
      </tr>
      {% for job in flagged_jobs %}
        <tr>
          <td>{{ job.title }}</td>
          <td>{{ job.employer.username|default:job.employer }}</td>
          <td>{{ job.flagged_reason|default:"(no reason provided)" }}</td>
          <td>
            <a href="{% url 'admin:job_list_job_change' job.id %}">Review</a> |
            <form action="{% url 'dashboard:approve_flagged_job' job.id %}" method="post" style="display:inline;" class="js-confirm" data-message="Approve this job? It will be unflagged and activated.">
              {% csrf_token %}
              <button type="submit" class="link-button">Approve</button>
            </form> |
            <form action="{% url 'dashboard:remove_flagged_job' job.id %}" method="post" style="display:inline;" class="js-confirm" data-message="Remove (deactivate) this job? It will no longer be visible to seekers.">
              {% csrf_token %}
              <button type="submit" class="link-button danger">Remove</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </table>
    </div>
  {% else %}
    <p>No flagged jobs right now ðŸŽ‰</p>
  {% endif %}
  </section>

  <!-- Management Links -->
  <section class="management-links">
    <h2>Management</h2>
    <a href="{% url 'admin:auth_user_changelist' %}">Manage Users</a>
    <a href="{% url 'admin:job_list_job_changelist' %}">Manage Jobs</a>
    <a href="{% url 'admin:job_list_application_changelist' %}">Manage Applications</a>
    <a href="{% url 'admin:profiles_employerprofile_changelist' %}">Manage Employer Profiles</a>
  </section>
</div>

<!-- Modal: Action Confirmation -->
<div id="confirmModal" class="rr-modal" aria-hidden="true">
  <div class="rr-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="confirmModalTitle">
    <h3 id="confirmModalTitle">Please Confirm</h3>
    <p id="confirmModalMessage">Are you sure?</p>
    <div class="rr-modal__actions">
      <button type="button" id="confirmCancel" class="btn btn-secondary">Cancel</button>
      <button type="button" id="confirmOk" class="btn btn-primary">Confirm</button>
    </div>
  </div>
  <button type="button" class="rr-modal__backdrop" aria-label="Close"></button>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'dashboard/js/admin_dashboard.js' %}"></script>
{% endblock %}
