{% extends "base.html" %}
{% load static %}

{% block title %}Matched Jobs{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'dashboard/css/matched_jobs.css' %}">

<div class="matched-jobs-wrapper">
  <h2>Matched Jobs Based on Your Skills</h2>
  <hr>

  <!-- Filters: ZIP + Radius -->
  <form method="get" action="{% url 'dashboard:matched_jobs' %}" class="match-filter-form" style="margin: 12px 0; display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
    <label>
      ZIP:
      <input type="text" name="zip" value="{{ selected_zip }}" placeholder="e.g., 19104" maxlength="5" style="width: 90px;">
    </label>
    <label>
      Radius (mi):
      <select name="radius">
        {% for r in  (10, 25, 50, 100) %}
          <option value="{{ r }}" {% if selected_radius == r %}selected{% endif %}>{{ r }}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit" class="btn btn-primary">Apply</button>
    {% if selected_zip %}
      <a href="{% url 'dashboard:matched_jobs' %}" class="btn btn-outline">Clear</a>
    {% endif %}
  </form>

  {% if matches %}
    <div class="job-listings">
      {% for job in matches %}
        <div class="job-card">
          <h4>{{ job.title }}</h4>
          <p>{{ job.description|truncatechars:150 }}</p>

          {% if job.skills_required.all %}
            <p><strong>Skills Required:</strong>
              {% for skill in job.skills_required.all %}
                <span class="badge-skill">{{ skill.name }}</span>
              {% endfor %}
            </p>
          {% endif %}

          {% if overlap_by_job and overlap_by_job[job.id] %}
            <p><strong>Matched Skills:</strong>
              {% for s in overlap_by_job[job.id] %}
                <span class="badge-skill badge-match">{{ s }}</span>
              {% endfor %}
            </p>
          {% endif %}

          <a href="{% url 'job_detail' job.id %}" class="view-job-btn">View Job</a>
        </div>
        <hr>
      {% endfor %}
    </div>
  {% else %}
    <p>No jobs matched your current skills. Try adding more skills to your profile.</p>
  {% endif %}
</div>
{% endblock %}

