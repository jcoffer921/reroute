{% extends "base.html" %}
{% load static %}

{% block title %}ReRoute | Profile{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/public_profile.css' %}">

<section class="profile-hero">
  <div class="profile-hero-content">
    <h1>Who You Are</h1>
    <p>Joined: {{ user.date_joined|date:"F j, Y" }}</p>
    <p>Status: <span class="account-status">{{ profile.account_status|capfirst }}</span></p>
    
  </div>
</section>

<div class="profile-container">
  <div class="profile-header">

   <!-- Center: Picture + Name + Badge + ID (read-only) -->
    <div class="profile-section profile-center">
      {% if profile.profile_picture %}
        <img
          src="{{ profile.profile_picture.url }}"
          class="profile-picture"
          alt="{{ profile.user.get_full_name|default:profile.user.username }}'s profile photo">
      {% else %}
        {# Initials fallback â€” no static file dependency #}
        <span class="profile-picture profile-initials" aria-hidden="true">
          {{ profile.user.first_name|default:profile.user.username|slice:":1" }}{{ profile.user.last_name|default:""|slice:":1" }}
        </span>
      {% endif %}
    </div>


      <h2 class="profile-name">
        {% if profile.firstname %}
          {{ profile.firstname }} (@{{ user.username }})
        {% else %}
          @{{ user.username }}
        {% endif %}
      </h2>

      <p class="user-id">
        User ID: <span class="uid">{{ profile.user_uid|stringformat:"s" }}</span>
      </p>


      {% if profile.verified %}
        <span class="verified-badge">Verified</span>
      {% endif %}
    </div>

  </div>

  <div class="profile-bio">
  <h3><strong>About:</strong></h3>

  <!-- Bio Display -->
  <p id="bioPreview">
    {% if profile.bio %}
      {{ profile.bio|truncatechars:200 }}
      {% if profile.bio|length > 200 %}
        <span id="showMoreBtn" style="color: blue; cursor: pointer;" onclick="toggleBio()">Show more</span>
      {% endif %}
    {% else %}
      <em>No bio yet.</em>
    {% endif %}
  </p>

  <!-- Hidden full bio -->
  <p id="fullBio" style="display: none;">{{ profile.bio }}</p>

  <!-- Edit Bio Button (Only show if it's the user's profile) -->
  {% if user == request.user %}
    <button onclick="toggleBioEdit()">Edit Bio</button>

    <!-- Hidden form for editing bio -->
    <form id="editBioForm" method="POST" action="{% url 'update_bio' %}" style="display: none;">
      {% csrf_token %}
      <textarea name="bio" rows="4" cols="50">{{ profile.bio }}</textarea><br>
      <button type="submit">Save</button>
      <button type="button" onclick="toggleBioEdit()">Cancel</button>
    </form>
  {% endif %}
</div>
<script src="{% static 'js/public_profile.js' %}" defer></script>
{% endblock %}